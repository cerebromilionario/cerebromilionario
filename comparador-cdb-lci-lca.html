<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Comparador CDB vs LCI/LCA (Bruto x Líquido) | Cérebro Milionário</title>
  <meta name="description" content="Compare CDB vs LCI/LCA com cálculo de rendimento bruto e líquido, IR regressivo, IOF (opcional) e equivalência de taxas. Ferramenta gratuita do Cérebro Milionário." />

  <!-- Icons -->
  <link rel="icon" href="/images/favicon.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- CSS -->
  <link rel="stylesheet" href="/css/style.css" />

  <!-- Canonical -->
  <link rel="canonical" href="https://peppy-lollipop-54fa27.netlify.app/comparador-cdb-lci-lca.html" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://peppy-lollipop-54fa27.netlify.app/comparador-cdb-lci-lca.html" />
  <meta property="og:title" content="Comparador CDB vs LCI/LCA (Bruto x Líquido) | Cérebro Milionário" />
  <meta property="og:description" content="Compare CDB vs LCI/LCA com cálculo de rendimento bruto e líquido, IR regressivo, IOF (opcional) e equivalência de taxas." />
  <meta property="og:image" content="https://peppy-lollipop-54fa27.netlify.app/images/og-calculadora.jpg" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://peppy-lollipop-54fa27.netlify.app/comparador-cdb-lci-lca.html" />
  <meta property="twitter:title" content="Comparador CDB vs LCI/LCA (Bruto x Líquido) | Cérebro Milionário" />
  <meta property="twitter:description" content="Compare CDB vs LCI/LCA com cálculo de rendimento bruto e líquido, IR regressivo, IOF (opcional) e equivalência de taxas." />
  <meta property="twitter:image" content="https://peppy-lollipop-54fa27.netlify.app/images/og-calculadora.jpg" />

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Comparador CDB vs LCI/LCA",
    "url": "https://peppy-lollipop-54fa27.netlify.app/comparador-cdb-lci-lca.html",
    "description": "Ferramenta gratuita para comparar CDB vs LCI/LCA com cálculo de rendimento bruto e líquido, IR regressivo, IOF (opcional) e equivalência de taxas.",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "BRL" },
    "publisher": { "@type": "Organization", "name": "Cérebro Milionário", "url": "https://peppy-lollipop-54fa27.netlify.app/" }
  }
  </script>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4613426749830025" crossorigin="anonymous"></script>

  <style>
    /* Pequenos ajustes locais (sem quebrar seu style.css) */
    .tool-grid { display: grid; grid-template-columns: 1fr; gap: var(--spacing-md, 16px); }
    @media (min-width: 992px) { .tool-grid { grid-template-columns: 1fr 1fr; } }
    .tool-card { background: var(--color-white, #fff); border-radius: var(--radius-lg, 16px); padding: var(--spacing-md, 16px); box-shadow: var(--shadow-md, 0 10px 30px rgba(0,0,0,.08)); border: 1px solid rgba(0,0,0,.06); }
    .tool-card h3 { margin-top: 0; margin-bottom: 8px; }
    .tool-row { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 576px) { .tool-row { grid-template-columns: 1fr 1fr; } }
    .tool-row-3 { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 992px) { .tool-row-3 { grid-template-columns: 1.4fr 1fr 1fr; } }

    .field { display: flex; flex-direction: column; gap: 6px; }
    .field label { font-weight: 600; font-size: .95rem; color: var(--color-text, #1a1a1a); }
    .field small { color: rgba(0,0,0,.65); line-height: 1.35; }
    .field input, .field select { width: 100%; padding: 12px 12px; border-radius: 12px; border: 1px solid rgba(0,0,0,.12); background: #fff; }
    .field input:focus, .field select:focus { outline: none; border-color: rgba(244,196,48,.9); box-shadow: 0 0 0 3px rgba(244,196,48,.2); }

    .btn-row { display:flex; gap: 12px; flex-wrap: wrap; margin-top: 12px; }
    .btn-row .btn { cursor: pointer; }

    .result-box { margin-top: var(--spacing-md, 16px); }
    .result-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 992px) { .result-grid { grid-template-columns: 1fr 1fr; } }
    .metric { background: rgba(0,0,0,.03); border: 1px solid rgba(0,0,0,.06); border-radius: 14px; padding: 14px; }
    .metric .k { color: rgba(0,0,0,.65); font-size: .92rem; }
    .metric .v { font-weight: 800; font-size: 1.15rem; margin-top: 4px; }
    .metric .s { color: rgba(0,0,0,.65); font-size: .9rem; margin-top: 6px; line-height: 1.35; }
    .badge { display:inline-flex; align-items:center; gap: 6px; padding: 6px 10px; border-radius: 999px; font-weight: 700; font-size: .85rem; }
    .badge.good { background: rgba(34,197,94,.12); color: #0f7a35; border: 1px solid rgba(34,197,94,.22); }
    .badge.neutral { background: rgba(59,130,246,.10); color: #1e4fae; border: 1px solid rgba(59,130,246,.20); }

    .table { width: 100%; border-collapse: collapse; margin-top: 10px; overflow: hidden; border-radius: 14px; border: 1px solid rgba(0,0,0,.08); }
    .table th, .table td { padding: 12px; border-bottom: 1px solid rgba(0,0,0,.06); text-align: left; }
    .table th { background: rgba(0,0,0,.03); font-weight: 800; }
    .table tr:last-child td { border-bottom: none; }
    .note { margin-top: 10px; color: rgba(0,0,0,.72); line-height: 1.55; }
  </style>
</head>

<body>
  <!-- Header (mesmo padrão do site) -->
  <header class="header">
    <div class="container header-container">
      <div class="logo">
        <h1><a href="/index.html">Cérebro Milionário</a></h1>
      </div>

      <button class="mobile-menu-btn" aria-label="Abrir menu" aria-expanded="false">
        <i class="fas fa-bars"></i>
      </button>

      <nav class="navigation" id="primary-navigation">
        <ul class="nav-menu">
          <li><a href="/index.html">Home</a></li>
          <li><a href="/calculadora.html" class="active">Calculadora</a></li>
          <li><a href="/aposentadoria.html">Aposentadoria</a></li>
          <li><a href="/cursos.html">Cursos</a></li>
          <li><a href="/blog.html">Blog</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero-section">
      <div class="container">
        <div class="hero-content animate-fade-in">
          <h1>Comparador CDB vs LCI/LCA</h1>
          <p>
            Compare o <strong>rendimento bruto x líquido</strong> considerando <strong>IR regressivo</strong> (CDB),
            <strong>isenção</strong> (LCI/LCA) e <strong>IOF</strong> (opcional). Também calcula <strong>taxa equivalente</strong>.
          </p>
        </div>
      </div>
    </section>

    <!-- AdSense Unit - Top -->
    <section class="ad-container adsense-responsive">
      <span class="ad-label">Publicidade</span>
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-4613426749830025"
           data-ad-slot="YOUR_AD_SLOT_ID_1"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </section>

    <!-- Tool -->
    <section class="calculator-section">
      <div class="container">
        <div class="section-header">
          <h2>Simulação</h2>
          <p>Preencha os dados e clique em <strong>Comparar</strong>. Se quiser máxima precisão, use o prazo real e informe CDI/IPCA atual.</p>
        </div>

        <div class="tool-card">
          <div class="tool-row-3">
            <div class="field">
              <label for="principal">Valor investido (R$)</label>
              <input id="principal" inputmode="decimal" placeholder="Ex.: 10.000" value="10000">
              <small>Digite sem ponto de milhar, se preferir. Aceita vírgula.</small>
            </div>

            <div class="field">
              <label for="prazo">Prazo</label>
              <input id="prazo" inputmode="numeric" placeholder="Ex.: 365" value="365">
            </div>

            <div class="field">
              <label for="prazoUnidade">Unidade</label>
              <select id="prazoUnidade">
                <option value="dias" selected>Dias corridos</option>
                <option value="meses">Meses</option>
              </select>
              <small>Meses serão convertidos para dias (média).</small>
            </div>
          </div>

          <div class="tool-row" style="margin-top:12px;">
            <div class="field">
              <label for="cdi">CDI (a.a.) — se usar “% do CDI”</label>
              <input id="cdi" inputmode="decimal" placeholder="Ex.: 10,65" value="10,65">
              <small>Informe o CDI anual atual (em % ao ano).</small>
            </div>

            <div class="field">
              <label for="ipca">IPCA (a.a.) — se usar “IPCA +”</label>
              <input id="ipca" inputmode="decimal" placeholder="Ex.: 4,00" value="4,00">
              <small>Use uma estimativa (em % ao ano) só para projeção.</small>
            </div>
          </div>

          <div class="tool-row" style="margin-top:12px;">
            <div class="field">
              <label for="considerarIof">IOF (até 29 dias)</label>
              <select id="considerarIof">
                <option value="nao" selected>Não considerar IOF</option>
                <option value="sim">Considerar IOF (se prazo &lt; 30 dias)</option>
              </select>
              <small>Na prática, o IOF incide sobre o lucro quando o resgate é antes de 30 dias.</small>
            </div>

            <div class="field">
              <label for="diasUteisMode">Dias úteis</label>
              <select id="diasUteisMode">
                <option value="aprox" selected>Aproximar (252/365)</option>
                <option value="corridos">Usar dias corridos mesmo</option>
              </select>
              <small>Para “% do CDI”, o padrão é aproximar dias úteis.</small>
            </div>
          </div>

          <div class="tool-grid" style="margin-top: 16px;">
            <!-- Produto A -->
            <div class="tool-card" style="box-shadow:none; border:1px dashed rgba(0,0,0,.18);">
              <h3><i class="fa-solid fa-a"></i> Produto A</h3>

              <div class="tool-row">
                <div class="field">
                  <label for="tipoA">Tipo</label>
                  <select id="tipoA">
                    <option value="CDB" selected>CDB</option>
                    <option value="LCI">LCI</option>
                    <option value="LCA">LCA</option>
                  </select>
                </div>

                <div class="field">
                  <label for="indexadorA">Rentabilidade</label>
                  <select id="indexadorA">
                    <option value="CDI" selected>% do CDI</option>
                    <option value="PRE">Prefixado (a.a.)</option>
                    <option value="IPCA">IPCA + (a.a.)</option>
                  </select>
                </div>
              </div>

              <div class="tool-row" style="margin-top: 12px;">
                <div class="field" id="taxaAField">
                  <label for="taxaA">Taxa (% do CDI)</label>
                  <input id="taxaA" inputmode="decimal" placeholder="Ex.: 110 (para 110% CDI)" value="110">
                  <small id="taxaAHelp">Ex.: 110 significa 110% do CDI.</small>
                </div>

                <div class="field">
                  <label>Imposto de Renda</label>
                  <div class="metric" style="padding:12px;">
                    <div class="k">IR</div>
                    <div class="v" id="irAInfo">Calculado pelo prazo</div>
                    <div class="s">LCI/LCA: isento. CDB: tabela regressiva.</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Produto B -->
            <div class="tool-card" style="box-shadow:none; border:1px dashed rgba(0,0,0,.18);">
              <h3><i class="fa-solid fa-b"></i> Produto B</h3>

              <div class="tool-row">
                <div class="field">
                  <label for="tipoB">Tipo</label>
                  <select id="tipoB">
                    <option value="CDB">CDB</option>
                    <option value="LCI" selected>LCI</option>
                    <option value="LCA">LCA</option>
                  </select>
                </div>

                <div class="field">
                  <label for="indexadorB">Rentabilidade</label>
                  <select id="indexadorB">
                    <option value="CDI" selected>% do CDI</option>
                    <option value="PRE">Prefixado (a.a.)</option>
                    <option value="IPCA">IPCA + (a.a.)</option>
                  </select>
                </div>
              </div>

              <div class="tool-row" style="margin-top: 12px;">
                <div class="field" id="taxaBField">
                  <label for="taxaB">Taxa (% do CDI)</label>
                  <input id="taxaB" inputmode="decimal" placeholder="Ex.: 95 (para 95% CDI)" value="95">
                  <small id="taxaBHelp">Ex.: 95 significa 95% do CDI.</small>
                </div>

                <div class="field">
                  <label>Imposto de Renda</label>
                  <div class="metric" style="padding:12px;">
                    <div class="k">IR</div>
                    <div class="v" id="irBInfo">Calculado pelo prazo</div>
                    <div class="s">LCI/LCA: isento. CDB: tabela regressiva.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="btn-row">
            <button class="btn btn-primary" id="btnComparar"><i class="fa-solid fa-scale-balanced"></i> Comparar</button>
            <button class="btn btn-secondary" id="btnReset"><i class="fa-solid fa-rotate-left"></i> Reset</button>
          </div>

          <div class="result-box" id="resultBox" style="display:none;">
            <div class="section-header" style="text-align:left; margin-top: 18px;">
              <h2 style="margin-bottom:6px;">Resultado</h2>
              <p id="headlineResult" style="margin:0;"></p>
            </div>

            <div class="result-grid" style="margin-top: 12px;">
              <div class="metric">
                <div class="k">Produto A — Valor final líquido</div>
                <div class="v" id="aFinal">—</div>
                <div class="s" id="aMeta">—</div>
              </div>
              <div class="metric">
                <div class="k">Produto B — Valor final líquido</div>
                <div class="v" id="bFinal">—</div>
                <div class="s" id="bMeta">—</div>
              </div>
            </div>

            <table class="table" aria-label="Tabela comparativa">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Produto A</th>
                  <th>Produto B</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Valor final bruto</td>
                  <td id="aBruto">—</td>
                  <td id="bBruto">—</td>
                </tr>
                <tr>
                  <td>Lucro bruto</td>
                  <td id="aLucroBruto">—</td>
                  <td id="bLucroBruto">—</td>
                </tr>
                <tr>
                  <td>IOF (se aplicável)</td>
                  <td id="aIof">—</td>
                  <td id="bIof">—</td>
                </tr>
                <tr>
                  <td>IR</td>
                  <td id="aIr">—</td>
                  <td id="bIr">—</td>
                </tr>
                <tr>
                  <td>Lucro líquido</td>
                  <td id="aLucroLiquido">—</td>
                  <td id="bLucroLiquido">—</td>
                </tr>
                <tr>
                  <td>Rentabilidade líquida no período</td>
                  <td id="aRentPeriodo">—</td>
                  <td id="bRentPeriodo">—</td>
                </tr>
              </tbody>
            </table>

            <div class="metric" style="margin-top:12px;">
              <div class="k">Taxa equivalente (atalho mental)</div>
              <div class="v" id="equivalencia">—</div>
              <div class="s">Cálculo de equivalência é mais útil quando ambos estão no mesmo indexador (ex.: %CDI).</div>
            </div>

            <p class="note">
              <strong>Atenção:</strong> esta ferramenta é educacional. Resultados podem variar por emissor, liquidez, carência, datas exatas e regras específicas do produto.
              Para “% do CDI”, usamos a opção de <em>dias úteis aproximados</em> (252/365) por padrão.
            </p>
          </div>
        </div>

        <!-- AdSense Unit - Mid -->
        <div class="ad-container adsense-responsive" style="margin-top: var(--spacing-lg, 24px);">
          <span class="ad-label">Publicidade</span>
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-4613426749830025"
               data-ad-slot="YOUR_AD_SLOT_ID_2"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <!-- Links internos (para SEO e navegação) -->
        <section style="margin-top: var(--spacing-lg, 24px);">
          <div class="section-header">
            <h2>Próximos passos (recomendado)</h2>
            <p>Use estes atalhos para aprofundar e manter o usuário no seu ecossistema.</p>
          </div>

          <div class="posts-grid">
            <div class="blog-card">
              <div class="blog-card-img">
                <img src="/images/post-juros-compostos.jpg" alt="Calculadora de Juros Compostos">
              </div>
              <div class="blog-card-content">
                <h3><a href="/calculadora.html">Calculadora de Juros Compostos</a></h3>
                <p>Simule aportes e o crescimento do seu patrimônio com gráficos e cenários.</p>
                <a href="/calculadora.html" class="btn btn-tertiary">Abrir</a>
              </div>
            </div>

            <div class="blog-card">
              <div class="blog-card-img">
                <img src="/images/post-investimentos-iniciantes.jpg" alt="Guia completo para iniciantes">
              </div>
              <div class="blog-card-content">
                <h3><a href="/posts/guia-completo-investimentos-iniciantes-2026.html">Artigo Pilar (2026)</a></h3>
                <p>O guia mais completo do site, com links para todos os temas essenciais.</p>
                <a href="/posts/guia-completo-investimentos-iniciantes-2026.html" class="btn btn-tertiary">Ler</a>
              </div>
            </div>

            <div class="blog-card">
              <div class="blog-card-img">
                <img src="/images/post-aposentadoria.jpg" alt="Aposentadoria">
              </div>
              <div class="blog-card-content">
                <h3><a href="/aposentadoria.html">Calculadora de Aposentadoria</a></h3>
                <p>Projete quando você pode se aposentar, com aportes e rentabilidade.</p>
                <a href="/aposentadoria.html" class="btn btn-tertiary">Simular</a>
              </div>
            </div>
          </div>
        </section>

      </div>
    </section>

    <!-- AdSense Unit - Bottom -->
    <section class="ad-container adsense-responsive">
      <span class="ad-label">Publicidade</span>
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-4613426749830025"
           data-ad-slot="YOUR_AD_SLOT_ID_3"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </section>
  </main>

  <!-- Footer (mesmo padrão do site) -->
  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-column">
          <h3 class="footer-logo">Cérebro Milionário</h3>
          <p class="footer-text">Capacitando você a tomar decisões financeiras inteligentes para um futuro próspero.</p>
          <div class="social-links">
            <a href="#" class="social-link" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="social-link" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="https://www.instagram.com/cerebromillionario/" target="_blank" class="social-link" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="https://youtube.com/@cerebromillionario?si=HXuHdkSfJpfBcT75" target="_blank" class="social-link" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
            <a href="#" class="social-link" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>
        <div class="footer-column">
          <h4 class="footer-heading">Navegação</h4>
          <ul class="footer-links">
            <li><a href="/index.html">Home</a></li>
            <li><a href="/calculadora.html">Calculadora</a></li>
            <li><a href="/aposentadoria.html">Aposentadoria</a></li>
            <li><a href="/cursos.html">Cursos</a></li>
            <li><a href="/blog.html">Blog</a></li>
            <li><a href="/politica-privacidade.html">Política de Privacidade</a></li>
            <li><a href="/termos-uso.html">Termos de Uso</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4 class="footer-heading">Recursos</h4>
          <ul class="footer-links">
            <li><a href="/glossario-financeiro.html">Glossário Financeiro</a></li>
            <li><a href="/perguntas-frequentes.html">Perguntas Frequentes</a></li>
            <li><a href="/guia-iniciantes.html">Guias para Iniciantes</a></li>
            <li><a href="/contato.html">Contato</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4 class="footer-heading">Newsletter</h4>
          <p class="footer-text">Receba dicas financeiras exclusivas diretamente no seu email.</p>
          <form class="newsletter-form">
            <input type="email" placeholder="Seu melhor email" required class="form-control">
            <button type="submit" class="btn btn-primary" style="margin-top: var(--spacing-sm); width: 100%;">Inscrever</button>
          </form>
        </div>
      </div>
      <div class="footer-bottom">
        &copy; <span id="current-year"></span> Cérebro Milionário. Todos os direitos reservados.
      </div>
    </div>
  </footer>

  <!-- Scripts do site -->
  <script src="/js/main.js"></script>

  <script>
    // Footer year
    document.getElementById('current-year').textContent = new Date().getFullYear();

    // Helpers
    function parseNumberBR(value) {
      if (value === null || value === undefined) return 0;
      const s = String(value).trim().replace(/\\./g, '').replace(',', '.');
      const n = Number(s);
      return Number.isFinite(n) ? n : 0;
    }

    function formatBRL(n) {
      return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(n);
    }

    function formatPct(n, digits = 2) {
      return (n * 100).toFixed(digits).replace('.', ',') + '%';
    }

    // IR regressivo (Brasil) - sobre o lucro
    function irRateByDays(days) {
      if (days <= 180) return 0.225;
      if (days <= 360) return 0.20;
      if (days <= 720) return 0.175;
      return 0.15;
    }

    // IOF regressivo (Brasil) - percentual do lucro (1..29 dias). Dia >= 30 -> 0
    const IOF_TABLE = [
      0,   // index 0 (não usado)
      0.96, 0.93, 0.90, 0.86, 0.83, 0.80, 0.76, 0.73, 0.70, 0.66,
      0.63, 0.60, 0.56, 0.53, 0.50, 0.46, 0.43, 0.40, 0.36, 0.33,
      0.30, 0.26, 0.23, 0.20, 0.16, 0.13, 0.10, 0.06, 0.03
    ];

    function iofRateByDays(days) {
      if (days >= 30) return 0;
      if (days <= 0) return 0;
      return IOF_TABLE[Math.min(days, 29)] || 0;
    }

    function daysFromInput(prazo, unidade) {
      if (unidade === 'meses') return prazo * 30.4167; // média (365/12)
      return prazo;
    }

    function effectiveReturn(indexador, taxa, days, cdiAA, ipcaAA, useBusinessDaysApprox) {
      const t = taxa / 100;     // taxa em decimal (ex. 110% => 1.10; 12% => 0.12)
      const cdi = cdiAA / 100;
      const ipca = ipcaAA / 100;

      if (indexador === 'CDI') {
        // Aproxima CDI por 252 dias úteis. Se prazo está em dias corridos, aproximamos dias úteis.
        const bdays = useBusinessDaysApprox ? (days * 252 / 365) : days;
        const cdiDaily = Math.pow(1 + cdi, 1/252) - 1;
        const dailyRate = cdiDaily * t; // %CDI * CDI diário
        return Math.pow(1 + dailyRate, bdays) - 1;
      }

      if (indexador === 'PRE') {
        return Math.pow(1 + t, days/365) - 1;
      }

      if (indexador === 'IPCA') {
        // Aproximação: (1+ipca)^(t) * (1+spread)^(t) - 1
        const spread = t;
        const fatorIpca = Math.pow(1 + ipca, days/365);
        const fatorSpread = Math.pow(1 + spread, days/365);
        return (fatorIpca * fatorSpread) - 1;
      }

      return 0;
    }

    function simulateProduct({ tipo, indexador, taxa, principal, days, cdiAA, ipcaAA, considerIOF, useBusinessDaysApprox }) {
      const periodReturn = effectiveReturn(indexador, taxa, days, cdiAA, ipcaAA, useBusinessDaysApprox);
      const finalBruto = principal * (1 + periodReturn);
      const lucroBruto = Math.max(0, finalBruto - principal);

      // IOF (opcional) - sobre o lucro
      const iofRate = considerIOF ? iofRateByDays(Math.floor(days)) : 0;
      const iof = lucroBruto * iofRate;

      const lucroAposIof = Math.max(0, lucroBruto - iof);

      // IR
      let irRate = 0;
      if (tipo === 'CDB') irRate = irRateByDays(Math.floor(days));
      // LCI/LCA são isentas de IR para PF
      const ir = lucroAposIof * irRate;

      const lucroLiquido = Math.max(0, lucroAposIof - ir);
      const finalLiquido = principal + lucroLiquido;

      const rentPeriodo = principal > 0 ? (finalLiquido / principal - 1) : 0;

      return {
        finalBruto, lucroBruto,
        iofRate, iof,
        irRate, ir,
        lucroLiquido, finalLiquido,
        rentPeriodo
      };
    }

    function taxaHelpText(indexador) {
      if (indexador === 'CDI') return 'Ex.: 110 significa 110% do CDI.';
      if (indexador === 'PRE') return 'Ex.: 12 significa 12% ao ano.';
      return 'Ex.: 6 significa IPCA + 6% ao ano.';
    }

    function updateTaxaHelp(which) {
      const idx = document.getElementById('indexador' + which).value;
      document.getElementById('taxa' + which + 'Help').textContent = taxaHelpText(idx);
      const label = document.querySelector('#taxa' + which + 'Field label');
      if (label) label.textContent = (idx === 'CDI') ? 'Taxa (% do CDI)' : 'Taxa (a.a.)';
    }

    function updateIRInfo(which) {
      const tipo = document.getElementById('tipo' + which).value;
      const prazo = parseNumberBR(document.getElementById('prazo').value);
      const unidade = document.getElementById('prazoUnidade').value;
      const days = daysFromInput(prazo, unidade);

      if (tipo === 'CDB') {
        const rate = irRateByDays(Math.floor(days));
        document.getElementById('ir' + which + 'Info').textContent = (rate*100).toFixed(1).replace('.', ',') + '% (regressivo)';
      } else {
        document.getElementById('ir' + which + 'Info').textContent = 'Isento (PF)';
      }
    }

    function equivalenciaText(days) {
      // Só calcula equivalência simples quando ambos forem %CDI, e um for LCI/LCA e outro for CDB
      const aTipo = document.getElementById('tipoA').value;
      const bTipo = document.getElementById('tipoB').value;
      const aIdx = document.getElementById('indexadorA').value;
      const bIdx = document.getElementById('indexadorB').value;

      if (aIdx !== 'CDI' || bIdx !== 'CDI') {
        return 'Para equivalência direta, use o mesmo indexador (idealmente %CDI em ambos).';
      }

      const ir = irRateByDays(Math.floor(days));
      const irPct = (ir*100).toFixed(1).replace('.', ',') + '%';

      const taxaA = parseNumberBR(document.getElementById('taxaA').value);
      const taxaB = parseNumberBR(document.getElementById('taxaB').value);

      // Se A é LCI/LCA e B é CDB:
      if ((aTipo === 'LCI' || aTipo === 'LCA') && bTipo === 'CDB') {
        const eq = taxaA / (1 - ir);
        return `${taxaA.toFixed(2).replace('.', ',')}% do CDI (LCI/LCA) ≈ ${eq.toFixed(2).replace('.', ',')}% do CDI em CDB (considerando IR ${irPct} pelo prazo).`;
      }
      // Se B é LCI/LCA e A é CDB:
      if ((bTipo === 'LCI' || bTipo === 'LCA') && aTipo === 'CDB') {
        const eq = taxaB / (1 - ir);
        return `${taxaB.toFixed(2).replace('.', ',')}% do CDI (LCI/LCA) ≈ ${eq.toFixed(2).replace('.', ',')}% do CDI em CDB (considerando IR ${irPct} pelo prazo).`;
      }

      return 'Equivalência é mais relevante quando comparamos CDB (com IR) versus LCI/LCA (isenta).';
    }

    function compare() {
      const principal = parseNumberBR(document.getElementById('principal').value);
      const prazo = parseNumberBR(document.getElementById('prazo').value);
      const unidade = document.getElementById('prazoUnidade').value;
      const days = daysFromInput(prazo, unidade);

      const cdiAA = parseNumberBR(document.getElementById('cdi').value);
      const ipcaAA = parseNumberBR(document.getElementById('ipca').value);

      const considerIOF = document.getElementById('considerarIof').value === 'sim';
      const useBusinessDaysApprox = document.getElementById('diasUteisMode').value === 'aprox';

      const a = simulateProduct({
        tipo: document.getElementById('tipoA').value,
        indexador: document.getElementById('indexadorA').value,
        taxa: parseNumberBR(document.getElementById('taxaA').value),
        principal, days, cdiAA, ipcaAA, considerIOF, useBusinessDaysApprox
      });

      const b = simulateProduct({
        tipo: document.getElementById('tipoB').value,
        indexador: document.getElementById('indexadorB').value,
        taxa: parseNumberBR(document.getElementById('taxaB').value),
        principal, days, cdiAA, ipcaAA, considerIOF, useBusinessDaysApprox
      });

      // Headline
      const diff = b.finalLiquido - a.finalLiquido;
      let badge = 'neutral';
      let icon = 'fa-circle-info';
      let label = 'Empate técnico';
      if (Math.abs(diff) > Math.max(1, principal * 0.001)) {
        if (diff > 0) { badge = 'good'; icon = 'fa-arrow-up-right-dots'; label = 'Produto B venceu'; }
        else { badge = 'good'; icon = 'fa-arrow-up-right-dots'; label = 'Produto A venceu'; }
      }
      document.getElementById('headlineResult').innerHTML =
        `<span class="badge ${badge}"><i class="fa-solid ${icon}"></i> ${label}</span>
         &nbsp; Diferença: <strong>${formatBRL(Math.abs(diff))}</strong> (líquido).`;

      // Fill metrics
      document.getElementById('aFinal').textContent = formatBRL(a.finalLiquido);
      document.getElementById('bFinal').textContent = formatBRL(b.finalLiquido);

      document.getElementById('aMeta').textContent =
        `Lucro líquido: ${formatBRL(a.lucroLiquido)} • Rentabilidade: ${formatPct(a.rentPeriodo)}`;
      document.getElementById('bMeta').textContent =
        `Lucro líquido: ${formatBRL(b.lucroLiquido)} • Rentabilidade: ${formatPct(b.rentPeriodo)}`;

      document.getElementById('aBruto').textContent = formatBRL(a.finalBruto);
      document.getElementById('bBruto').textContent = formatBRL(b.finalBruto);

      document.getElementById('aLucroBruto').textContent = formatBRL(a.lucroBruto);
      document.getElementById('bLucroBruto').textContent = formatBRL(b.lucroBruto);

      document.getElementById('aIof').textContent = a.iof > 0 ? `${formatBRL(a.iof)} (${(a.iofRate*100).toFixed(0)}% do lucro)` : '—';
      document.getElementById('bIof').textContent = b.iof > 0 ? `${formatBRL(b.iof)} (${(b.iofRate*100).toFixed(0)}% do lucro)` : '—';

      document.getElementById('aIr').textContent = a.ir > 0 ? `${formatBRL(a.ir)} (${(a.irRate*100).toFixed(1).replace('.', ',')}%)` : '—';
      document.getElementById('bIr').textContent = b.ir > 0 ? `${formatBRL(b.ir)} (${(b.irRate*100).toFixed(1).replace('.', ',')}%)` : '—';

      document.getElementById('aLucroLiquido').textContent = formatBRL(a.lucroLiquido);
      document.getElementById('bLucroLiquido').textContent = formatBRL(b.lucroLiquido);

      document.getElementById('aRentPeriodo').textContent = formatPct(a.rentPeriodo);
      document.getElementById('bRentPeriodo').textContent = formatPct(b.rentPeriodo);

      document.getElementById('equivalencia').textContent = equivalenciaText(days);

      document.getElementById('resultBox').style.display = 'block';
      document.getElementById('resultBox').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function resetAll() {
      document.getElementById('principal').value = '10000';
      document.getElementById('prazo').value = '365';
      document.getElementById('prazoUnidade').value = 'dias';
      document.getElementById('cdi').value = '10,65';
      document.getElementById('ipca').value = '4,00';
      document.getElementById('considerarIof').value = 'nao';
      document.getElementById('diasUteisMode').value = 'aprox';

      document.getElementById('tipoA').value = 'CDB';
      document.getElementById('indexadorA').value = 'CDI';
      document.getElementById('taxaA').value = '110';

      document.getElementById('tipoB').value = 'LCI';
      document.getElementById('indexadorB').value = 'CDI';
      document.getElementById('taxaB').value = '95';

      updateTaxaHelp('A'); updateTaxaHelp('B');
      updateIRInfo('A'); updateIRInfo('B');

      document.getElementById('resultBox').style.display = 'none';
    }

    // Events
    document.getElementById('btnComparar').addEventListener('click', compare);
    document.getElementById('btnReset').addEventListener('click', resetAll);

    ['indexadorA','indexadorB'].forEach(id => {
      document.getElementById(id).addEventListener('change', () => {
        updateTaxaHelp(id.endsWith('A') ? 'A' : 'B');
      });
    });

    ['tipoA','tipoB','prazo','prazoUnidade'].forEach(id => {
      document.getElementById(id).addEventListener('change', () => {
        updateIRInfo('A'); updateIRInfo('B');
      });
      document.getElementById(id).addEventListener('input', () => {
        updateIRInfo('A'); updateIRInfo('B');
      });
    });

    // init
    updateTaxaHelp('A'); updateTaxaHelp('B');
    updateIRInfo('A'); updateIRInfo('B');
  </script>
</body>
</html>
